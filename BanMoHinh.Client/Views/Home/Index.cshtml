@using BanMoHinh.Share.Models;
@using BanMoHinh.Share.ViewModels;
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration;
@model IEnumerable<BanMoHinh.Share.ViewModels.ProductVM>;
@{

    List<ProductVM> product = ViewData["NewestProducts"] as List<ProductVM>;
    List<ProductDetailVM> productDetail = ViewData["productDetail"] as List<ProductDetailVM>;
    List<ProductImage> ProductImage = ViewData["ProductImage"] as List<ProductImage>;
    List<ProductDetailVM> bestSell = ViewData["TopSellingProducts"] as List<ProductDetailVM>;
}

<!-- slider -->
<div class="container">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <div class="slider">
        <div class="owl-carousel owl-one owl-theme">
          <div class="item">
            <div class="slider-img">
              <img src="/img/slide_2_img.webp" alt="" />
            </div>
          </div>
          <div class="item">
            <div class="slider-img">
              <img src="/img/slide_3_img.webp" alt="" />
            </div>
          </div>
          <div class="item">
            <div class="slider-img">
              <img src="/img/slide_4_img.webp" alt="" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- /.slider -->
@*sản phẩm mới*@
@if (product!= null && product.Any())
{
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="box">

                    <div class="box-head">
                        <h3 class="head-title">Sản phẩm mới nhất</h3>
                    </div>
                    <div class="box-body">
                        <div class="row">
                            <!-- product -->

                            @foreach (var item in product)
                            {
                            IEnumerable<ProductDetailVM> LstProductDetail = productDetail.Where(c => c.ProductId == item.Id);
                            var productDetailID = LstProductDetail.FirstOrDefault().Id; // lấy id productdetail 
                            var lstProductImage = ProductImage.Where(c => c.ProductDetailId == productDetailID); // lấy list img
                            var imgFirst = lstProductImage.FirstOrDefault().ImageUrl; // lấy img đầu tiên
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <a href="/Product/ProductDetail/@item.Id">
                                    <div class="product-block" >
                                    <div class="product-img"><img src="@(Configuration["BaseAddress"]+imgFirst)" alt=""></div>
                                    <div class="product-content">
                                        <h5><a href="/Product/ProductDetail/@item.Id" class="product-title">@item.ProductName <strong>(@item.BrandName, @item.MaterialName, @item.CategoryName)</strong></a></h5>
                                        <div class="product-meta">
                                        <a href="#" class="product-price">
                                            @if (item.MinPrice < item.MaxPrice)
                                            {
                                                <span>
                                                    @item.MinPrice?.ToString("N0") VND  - @item.MaxPrice?.ToString("N0") VND
                                                </span>
                                            }
                                            else
                                            {
                                                <span>
                                                    @item.MinPrice?.ToString("N0") VND
                                                </span>
                                            }
                                        </a>
                                            <a href="#" class="discounted-price"></a>
                                            <span class="offer-price">20%off</span>
                                        </div>
                                        <div class="shopping-btn">
                                            <a href="#" class="product-btn btn-like" onclick="addToWishList('@item.Id')"><i class="fa fa-heart"></i></a>
                                            <a href="#" class="product-btn btn-cart"><i class="fa fa-shopping-cart"></i></a>
                                        </div>
                                    </div>
                                        </div>
                                   
                            </div>
                            }
                            
                            <!-- /.product -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
    {
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-warning">
                @TempData["Message"]
            </div>
        }
        <!-- Hiển thị thông báo nếu không có dữ liệu -->
    }
@*sản phẩm bán chạy*@
<div class="container">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="box">
                <div class="box-head">
                    <h3 class="head-title">Sản phẩm bán chạy </h3>
                </div>
            </div>
        </div>
    </div>
    <div class="product-carousel">
        <div class="box-body">
            <div class="row">
                <div class="owl-carousel owl-two owl-theme">
                    <!-- product -->
                    <div class="item">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            @*@foreach (var item in bestSell)
                            {
                                var lstProductImage = ProductImage.Where(c => c.ProductDetailId == item.Id); // lấy list img
                                var imgFirst = lstProductImage.FirstOrDefault().ImageUrl;
                                <div class="product-block">
                                    <div class="product-img"><img src="@(Configuration["BaseAddress"]+imgFirst)" alt=""></div>
                                    <div class="product-content">
                                        <h5><a href="#" class="product-title">@item.ProductName<strong>(32 GB, Gold)</strong></a></h5>
                                        <div class="product-meta"><a href="#" class="product-price">@item.PriceSale</a>
                                            <a href="#" class="discounted-price">$2000</a>
                                            <span class="offer-price">20%off</span>
                                        </div>
                                        <div class="shopping-btn">
                                            <a href="#" class="product-btn btn-like"><i class="fa fa-heart"></i></a>
                                            <a href="#" class="product-btn btn-cart"><i class="fa fa-shopping-cart"></i></a>
                                        </div>
                                    </div>
                                </div>
                            }*@
                            
                        </div>
                        <!-- /.product -->
                    </div>
                    <!-- product -->
                    
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function addToWishList(productId) {
    $.ajax({
        type: "POST",
        url: "/Product/WishList",
        data: { ProductId: productId },
        success: function (response) {
            if (response.success) {
                // Hiển thị SweetAlert khi thêm thành công
                Swal.fire({
                    icon: 'success',
                    title: 'Thành công!',
                    text: 'Sản phẩm đã được thêm vào danh sách yêu thích.',
                    showConfirmButton: true, // Hiển thị nút xác nhận
                    confirmButtonText: 'Xem danh sách yêu thích', // Text cho nút xác nhận
                    timer: 3000
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Nếu người dùng ấn xác nhận, chuyển hướng đến trang danh sách yêu thích
                        window.location.href = "/Product/ShowWishList";
                    }
                });
            } else {
                // Hiển thị SweetAlert khi có lỗi
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: response.errorMessage || 'Có lỗi xảy ra khi thêm sản phẩm vào danh sách yêu thích.'
                });
            }
        },
        error: function (xhr, status, error) {
            // Xử lý khi có lỗi
            console.log(error);
            // Hiển thị thông báo lỗi cho người dùng
        }
    });
}


    </script>
